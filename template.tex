\documentclass[12pt,a4paper]{article}
\usepackage[margin=2.5cm]{geometry}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{fontspec}
\usepackage[hidelinks]{hyperref} 
\usepackage{titlesec}
\usepackage{titling}
\usepackage{setspace}
\usepackage{tocloft}
\usepackage{etoolbox}
\usepackage{xcolor}
\usepackage{longtable}
\usepackage{calc}       % allows arithmetic in width specs
\usepackage{ragged2e}   % improves text alignment in table cells
\usepackage{xfp}
\usepackage{array}
\usepackage{booktabs}
\usepackage[spanish, es-noshorthands]{babel}

% --- Pandoc table width safety fix ---
\providecommand{\real}[1]{#1} % neutralize \real if undefined

% ==============================
% FONT
% ==============================
\setmainfont{Liberation Sans}
\newfontfamily\fallbackfont{Noto Sans}
\newfontfamily\symbolfont{Noto Sans Symbols2}
\usepackage[Latin,LatinExtendedAdditional,Symbols]{ucharclasses}

% Transitions for different character classes
\setTransitionsFor{Symbols}{\symbolfont}{\normalfont}
\setTransitionsFor{LatinExtendedAdditional}{\fallbackfont}{\normalfont}

% Specifically for accented characters, and any other problematic ones:
\newfontfamily\accentsfont{Noto Sans}[Contextuals={WordInitial,WordFinal}]


% ==============================
% HEADER & FOOTER
% ==============================
\pagestyle{fancy}
% Adjust header spacing
\setlength{\headheight}{40pt}  % increase if logos are taller
\setlength{\headsep}{25pt}     % space between header and body
\addtolength{\topmargin}{-10pt} % fine-tune vertical offset if needed
\fancyhf{} % clear all
%\lhead{\includegraphics[width=\textwidth]{image.png}}
\lhead{%
  \setlength{\tabcolsep}{2pt}
  \renewcommand{\arraystretch}{1.2}
  \begin{tabular}{m{3cm}m{9cm}m{3cm}|}
    \centering\includegraphics[width=2.4cm]{logo_ies.png} &
    \centering
    \textbf{I.E.S. Mar de Cádiz}\\
    \textit{Enseñanza - Aprendizaje}\\
    \textbf{Programación}\\[2pt]
    Rev. 15/10/2025 &
    \centering\includegraphics[width=2.8cm]{logo_junta.png} \\
  \end{tabular}
}
\lfoot{Módulo $CODIGO$ - Curso $CURSO$}
\rfoot{Página \thepage\ de \pageref{LastPage}}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.4pt}

% ==============================
% COVER PAGE
% ==============================
\newcommand{\makecover}{
  \begin{titlepage}
    \thispagestyle{fancy}
    \begin{center}
        \begin{tabular}{m{3cm}m{9cm}m{3cm}|}
          \centering\includegraphics[width=2.4cm]{logo_ies.png} &
          \centering
          \textbf{I.E.S. Mar de Cádiz}\\
          \textit{Enseñanza - Aprendizaje}\\
          \textbf{Programación}\\[2pt]
          Rev. 15/10/2025 &
          \centering\includegraphics[width=2.8cm]{logo_junta.png} \\
      \end{tabular}
    \end{center}
    \vfill
    \begin{center}
      \vspace*{0.25\textheight}
      {\Huge\bfseries PROGRAMACIÓN DIDÁCTICA DEL MÓDULO\par}
      \vspace{2cm}
      {\LARGE Código $CODIGO$ - $TITLE$\par}
      \vspace{2cm}
      {\Large $CICLO$\par}
    \end{center}

    \vfill
    \begin{flushright}
      \textbf{Dpto. Informática y Comunicaciones}\\
      I.E.S. MAR DE CÁDIZ\\
      El Puerto de Santa María -- Cádiz\\
      Curso 2025/2026
    \end{flushright}
  \end{titlepage}
}


% ==============================
% TABLE OF CONTENTS
% ==============================
\setcounter{tocdepth}{2}
\newcommand{\maketoc}{
  \thispagestyle{fancy}
  \tableofcontents
  \clearpage
}

% Pandoc list compatibility
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% ==============================
% DOCUMENT BODY
% ==============================
\begin{document}

\makecover
\maketoc

$body$

\end{document}
